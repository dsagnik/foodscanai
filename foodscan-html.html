<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodScan AI - Ingredient Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .active\:scale-98:active { transform: scale(0.98); }
        .group:hover .group-hover\:scale-110 { transform: scale(1.1); }
        .group:hover .group-hover\:translate-x-1 { transform: translateX(0.25rem); }
        .group:hover .group-hover\:rotate-12 { transform: rotate(12deg); }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 pb-24">
    <!-- Header -->
    <div class="bg-gradient-to-r from-emerald-600 to-teal-600 shadow-xl">
        <div class="px-6 py-8">
            <div class="flex items-center justify-center gap-3 mb-2">
                <svg class="text-yellow-300" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <path d="M12 3l1.912 5.813a2 2 0 001.902 1.382h6.11l-4.944 3.59a2 2 0 00-.727 2.236l1.912 5.813-4.944-3.59a2 2 0 00-2.354 0l-4.944 3.59 1.912-5.813a2 2 0 00-.727-2.236L2.076 10.195h6.11a2 2 0 001.902-1.382L12 3z"/>
                </svg>
                <h1 class="text-4xl font-black text-white">FoodScan AI</h1>
            </div>
            <p class="text-emerald-50 text-center text-lg font-medium">Smart ingredient analysis with Google Gemini</p>
        </div>
    </div>

    <div class="px-5 py-6 max-w-2xl mx-auto" id="app">

        <!-- Main Content -->
        <div id="homeScreen" class="space-y-5">
            <!-- Quick Scan Card -->
            <div class="bg-gradient-to-br from-white to-emerald-50 rounded-3xl p-8 shadow-xl border border-emerald-100">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-emerald-100 p-3 rounded-2xl">
                        <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-emerald-600">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">Quick Scan</h2>
                </div>
                <p class="text-gray-600 mb-6 text-base leading-relaxed">Point your camera at any food label and let AI decode the ingredients for you instantly.</p>
                <button onclick="document.getElementById('fileInput').click()" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-2xl py-5 px-6 text-xl font-bold shadow-lg hover:shadow-xl active:scale-98 transition-all flex items-center justify-center gap-3 group">
                    <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="group-hover:scale-110 transition-transform">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
                    </svg>
                    Scan Label Now
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="group-hover:translate-x-1 transition-transform">
                        <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
                    </svg>
                </button>
                <input type="file" id="fileInput" accept="image/*" capture="environment" class="hidden" onchange="handleFileUpload(event)">
            </div>

            <!-- Divider -->
            <div class="flex items-center gap-4">
                <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
                <span class="text-gray-500 font-semibold text-sm">OR</span>
                <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
            </div>

            <!-- Manual Entry -->
            <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100">
                <div class="flex items-center gap-3 mb-3">
                    <div class="bg-blue-100 p-2.5 rounded-xl">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-blue-600">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">Manual Entry</h3>
                </div>
                <p class="text-gray-600 mb-4 text-sm leading-relaxed">Already have the ingredients list? Paste it here for instant analysis.</p>
                <button onclick="showTextInput()" class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-xl py-4 px-5 text-lg font-bold shadow-md hover:shadow-lg active:scale-98 transition-all flex items-center justify-center gap-2">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    Paste Ingredients
                </button>
            </div>

            <!-- How It Works -->
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-7 shadow-lg border border-purple-100">
                <div class="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-purple-600">
                        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <h3 class="font-bold text-xl text-gray-900">How It Works</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex gap-4 items-start">
                        <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">1</div>
                        <div><p class="font-semibold text-gray-900">Capture or Paste</p><p class="text-gray-600 text-sm">Take a photo or paste the ingredients list</p></div>
                    </div>
                    <div class="flex gap-4 items-start">
                        <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">2</div>
                        <div><p class="font-semibold text-gray-900">AI Processing</p><p class="text-gray-600 text-sm">Google Gemini extracts and analyzes ingredients</p></div>
                    </div>
                    <div class="flex gap-4 items-start">
                        <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">3</div>
                        <div><p class="font-semibold text-gray-900">Instant Insights</p><p class="text-gray-600 text-sm">Get clear explanations and recommendations</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text Input Screen -->
        <div id="textInputScreen" class="bg-white rounded-3xl p-7 shadow-xl border border-gray-100 hidden">
            <div class="flex items-center gap-3 mb-5">
                <div class="bg-blue-100 p-3 rounded-xl">
                    <svg width="26" height="26" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-blue-600">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Enter Ingredients</h2>
            </div>
            <textarea id="textInput" placeholder="Example: Water, Sugar, Wheat Flour, Palm Oil, Salt, Artificial Flavoring, Sodium Benzoate (Preservative), Yellow 5, Red 40" class="w-full border-2 border-gray-200 rounded-2xl p-5 text-base min-h-44 focus:border-blue-400 focus:ring-4 focus:ring-blue-100 focus:outline-none transition-all"></textarea>
            <div class="flex gap-3 mt-5">
                <button onclick="analyzeText()" class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-xl py-4 text-lg font-bold shadow-md active:scale-98 transition-all flex items-center justify-center gap-2">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <path d="M12 3l1.912 5.813a2 2 0 001.902 1.382h6.11l-4.944 3.59a2 2 0 00-.727 2.236l1.912 5.813-4.944-3.59a2 2 0 00-2.354 0l-4.944 3.59 1.912-5.813a2 2 0 00-.727-2.236L2.076 10.195h6.11a2 2 0 001.902-1.382L12 3z"/>
                    </svg>
                    Analyze Now
                </button>
                <button onclick="hideTextInput()" class="px-7 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl py-4 text-lg font-bold active:scale-98 transition-all">Cancel</button>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loadingScreen" class="flex flex-col items-center justify-center py-24 hidden">
            <div class="relative">
                <svg class="w-20 h-20 text-emerald-500 animate-spin" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/>
                </svg>
                <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="w-8 h-8 text-yellow-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <path d="M12 3l1.912 5.813a2 2 0 001.902 1.382h6.11l-4.944 3.59a2 2 0 00-.727 2.236l1.912 5.813-4.944-3.59a2 2 0 00-2.354 0l-4.944 3.59 1.912-5.813a2 2 0 00-.727-2.236L2.076 10.195h6.11a2 2 0 001.902-1.382L12 3z"/>
                </svg>
            </div>
            <p class="text-2xl font-bold text-gray-800 mt-6">Analyzing ingredients...</p>
            <p class="text-gray-500 mt-2 text-lg">Our AI is working its magic ‚ú®</p>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="space-y-5 hidden"></div>
    </div>

    <!-- Disclaimer -->
    <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t-2 border-gray-200 px-5 py-4 shadow-2xl">
        <p class="text-xs text-gray-600 text-center leading-relaxed max-w-2xl mx-auto">
            <span class="font-bold text-gray-800">‚ö†Ô∏è Medical Disclaimer:</span> This tool provides general information only and is not medical advice. Always consult healthcare professionals for dietary concerns or allergies.
        </p>
    </div>

    <script>
        const apiKey = 'AIzaSyCsLWYkaN5dS0gAzjy-rNszuAig3cpYDRg';
        let currentAnalysis = null;

        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function showTextInput() {
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('textInputScreen').classList.remove('hidden');
        }

        function hideTextInput() {
            document.getElementById('textInputScreen').classList.add('hidden');
            document.getElementById('homeScreen').classList.remove('hidden');
        }

        function showLoading() {
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('textInputScreen').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');
            hideError();
        }

        function hideLoading() {
            document.getElementById('loadingScreen').classList.add('hidden');
        }

        function showResults() {
            hideLoading();
            document.getElementById('resultsScreen').classList.remove('hidden');
        }

        function resetToHome() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('homeScreen').classList.remove('hidden');
            document.getElementById('textInput').value = '';
            currentAnalysis = null;
        }

            async function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                showLoading();

                try {
                    const base64 = await fileToBase64(file);
                    const ingredients = await extractIngredients(base64, file.type);

                    if (ingredients.includes('No ingredients found')) {
                        hideLoading();
                        showError('Could not find ingredients in the image. Please try again with a clearer photo.');
                        document.getElementById('homeScreen').classList.remove('hidden');
                        return;
                    }

                    await analyzeIngredients(ingredients);
                } catch (error) {
                    hideLoading();
                    showError(error.message || 'Failed to analyze image. Please try again.');
                    document.getElementById('homeScreen').classList.remove('hidden');
                }

                event.target.value = '';
            }

            const text = document.getElementById('textInput').value.trim();
            if (!text) return;

            showLoading();
            
            try {
                await analyzeIngredients(text);
            } catch (error) {
                hideLoading();
                showError(error.message || 'Failed to analyze ingredients. Please try again.');
                document.getElementById('homeScreen').classList.remove('hidden');
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function extractIngredients(base64Data, mimeType) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-001:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { text: 'Extract ALL ingredient text from this food label image. Return ONLY the ingredients list, nothing else. If you cannot find ingredients, say "No ingredients found".' },
                            { inline_data: { mime_type: mimeType, data: base64Data } }
                        ]
                    }]
                })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message || 'API Error');
            return data.candidates[0].content.parts[0].text;
        }

        async function analyzeIngredients(ingredients) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-001:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `Analyze these food ingredients in simple language. Return ONLY valid JSON with this exact structure:
{
  "okay": ["ingredient: brief explanation"],
  "concerns": ["ingredient: brief explanation"],
  "summary": "2-3 sentence overall assessment",
  "uncertainty": "mention if anything is unclear"
}

Ingredients: ${ingredients}

Rules:
- Use simple, friendly language
- No medical advice
- Be honest about uncertainty
- Focus on common concerns (allergens, additives, processing)
- Keep explanations brief`
                        }]
                    }]
                })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message || 'API Error');

            let text = data.candidates[0].content.parts[0].text;
            text = text.replace(/```json/g, '').replace(/```/g, '').trim();
            
            let parsed;
                try {
                    parsed = JSON.parse(text);
                } catch (e) {
                    throw new Error('AI response was not valid JSON. Try again.');
                }

                currentAnalysis = parsed;
                displayResults(currentAnalysis);
            displayResults(currentAnalysis);
        }

        function displayResults(analysis) {
            const resultsHTML = `
                <div class="bg-gradient-to-r from-emerald-500 to-teal-500 rounded-3xl p-6 shadow-xl text-white">
                    <div class="flex items-center gap-3">
                        <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="flex-shrink-0">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <div>
                            <h2 class="text-2xl font-bold">Analysis Complete!</h2>
                            <p class="text-emerald-50 text-sm">Here's what we found</p>
                        </div>
                    </div>
                </div>

                ${analysis.okay && analysis.okay.length > 0 ? `
                <div class="bg-white rounded-3xl p-7 shadow-lg border-l-4 border-green-500">
                    <div class="flex items-center gap-3 mb-5">
                        <div class="bg-green-100 p-3 rounded-xl">
                            <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-green-600">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900">Safe Ingredients</h2>
                    </div>
                    <ul class="space-y-4">
                        ${analysis.okay.map(item => `
                            <li class="flex gap-3 items-start">
                                <div class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">
                                    <span class="text-sm font-bold">‚úì</span>
                                </div>
                                <p class="text-gray-700 text-base leading-relaxed">${item}</p>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                ` : ''}

                ${analysis.concerns && analysis.concerns.length > 0 ? `
                <div class="bg-white rounded-3xl p-7 shadow-lg border-l-4 border-amber-500">
                    <div class="flex items-center gap-3 mb-5">
                        <div class="bg-amber-100 p-3 rounded-xl">
                            <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-amber-600">
                                <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900">Watch Out For</h2>
                    </div>
                    <ul class="space-y-4">
                        ${analysis.concerns.map(item => `
                            <li class="flex gap-3 items-start">
                                <div class="bg-amber-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">
                                    <span class="text-sm font-bold">!</span>
                                </div>
                                <p class="text-gray-700 text-base leading-relaxed">${item}</p>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                ` : ''}

                ${analysis.summary ? `
                <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-3xl p-7 shadow-lg border-2 border-blue-200">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="bg-blue-500 p-3 rounded-xl">
                            <svg width="26" height="26" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="text-white">
                                <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900">Overall Summary</h2>
                    </div>
                    <p class="text-gray-800 text-base leading-relaxed font-medium">${analysis.summary}</p>
                </div>
                ` : ''}

                ${analysis.uncertainty ? `
                <div class="bg-gray-50 rounded-2xl p-6 border-2 border-gray-200">
                    <p class="text-gray-700 text-sm leading-relaxed">
                        <span class="font-bold text-gray-900">üìå Note:</span> ${analysis.uncertainty}
                    </p>
                </div>
                ` : ''}

                <button onclick="resetToHome()" class="w-full bg-gradient-to-r from-gray-700 to-gray-900 hover:from-gray-800 hover:to-black text-white rounded-2xl py-5 px-6 text-xl font-bold shadow-lg hover:shadow-xl active:scale-98 transition-all flex items-center justify-center gap-3 group">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="group-hover:rotate-12 transition-transform">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
                    </svg>
                    Scan Another Label
                </button>
            `;

            document.getElementById('resultsScreen').innerHTML = resultsHTML;
            showResults();
        }
    </script>
</body>
</html>